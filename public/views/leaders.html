<!DOCTYPE html>
<html>
<head>
    <title>Leaders</title>
    <link rel="stylesheet" type="text/css" href="/public/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/public/styles/leaders.css">
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <nav class="top desktop-only anchor">
        <ul class="left">
        <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?> <meter min="0" max="1" value="<?php echo ($stats['expPercentage'] ?? 0); ?>"></meter></li>
            <li><?php echo number_format($stats['diamonds'] ?? 0); ?> ðŸ’Ž</li>
            <li><?php echo $stats['streak'] ?? 0; ?> <?php echo ($stats['streakActive'] ?? false) ? 'ðŸ”¥' : 'ðŸ§Š'; ?></li>
        <?php endif; ?>
        </ul>
        <ul class="right">
            <li><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>
    <nav class="top mobile-only anchor">
        <ul>
        <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?> <meter min="0" max="1" value="<?php echo ($stats['expPercentage'] ?? 0); ?>"></meter></li>
            <li><?php echo number_format($stats['diamonds'] ?? 0); ?> ðŸ’Ž</li>
            <li><?php echo $stats['streak'] ?? 0; ?> <?php echo ($stats['streakActive'] ?? false) ? 'ðŸ”¥' : 'ðŸ§Š'; ?></li>
        <?php endif; ?>
        </ul>
    </nav>
    <main class="scrollable">
        <div class="selection-bar">
            <button class="tab-button <?php echo ($period ?? 'all') == 'weekly' ? 'active' : ''; ?>" onclick="window.location.href='/leaders?period=weekly'">Weekly</button>
            <button class="tab-button <?php echo ($period ?? 'all') == 'monthly' ? 'active' : ''; ?>" onclick="window.location.href='/leaders?period=monthly'">Monthly</button>
            <button class="tab-button <?php echo ($period ?? 'all') == 'yearly' ? 'active' : ''; ?>" onclick="window.location.href='/leaders?period=yearly'">Yearly</button>
            <button class="tab-button <?php echo ($period ?? 'all') == 'all' ? 'active' : ''; ?>" onclick="window.location.href='/leaders?period=all'">All Time</button>
        </div>
        
        <div class="leaderboard-container">
            <?php if (!empty($leaders)): ?>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>User</th>
                            <th>Level</th>
                            <th>Total Upvotes</th>
                            <th>Posts</th>
                            <th>Streak</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php $rank = 1; ?>
                        <?php foreach ($leaders as $leader): ?>
                            <tr class="leader-row" onclick="window.location.href='/profile/<?php echo htmlspecialchars($leader['username']); ?>'">
                                <td class="rank">
                                    <?php if ($rank == 1): ?>
                                        <span class="medal gold">ðŸ¥‡</span>
                                    <?php elseif ($rank == 2): ?>
                                        <span class="medal silver">ðŸ¥ˆ</span>
                                    <?php elseif ($rank == 3): ?>
                                        <span class="medal bronze">ðŸ¥‰</span>
                                    <?php else: ?>
                                        <span class="rank-number"><?php echo $rank; ?></span>
                                    <?php endif; ?>
                                </td>
                                <td class="user-info">
                                    <span class="username"><?php echo htmlspecialchars($leader['username']); ?></span>
                                </td>
                                <td class="level"><?php echo htmlspecialchars($leader['level'] ?? 1); ?></td>
                                <td class="upvotes"><span class="material-symbols-outlined">thumb_up</span> <?php echo number_format($leader['total_upvotes']); ?></td>
                                <td class="posts"><?php echo number_format($leader['posts_count']); ?></td>
                                <td class="streak"><?php echo htmlspecialchars($leader['streak'] ?? 0); ?> ðŸ”¥</td>
                            </tr>
                            <?php $rank++; ?>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            <?php else: ?>
                <p class="no-data">No leaderboard data available for this period.</p>
            <?php endif; ?>
        </div>
    </main>
    <nav class="bottom mobile-only anchor">
        <ul>
            <li class="mobile-only"><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li class="mobile-only"><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li class="mobile-only"><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li class="mobile-only"><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li class="mobile-only"><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>
</body>
</html>