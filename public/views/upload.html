<!DOCTYPE html>
<html>
<head>
    <title>Upload</title>
    <link rel="stylesheet" type="text/css" href="/public/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/public/styles/upload.css">
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <nav class="top desktop-only anchor">
        <ul class="left">
        <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?> <meter min="0" max="1" value="<?php echo ($stats['expPercentage'] ?? 0); ?>"></meter></li>
            <li><?php echo number_format($stats['diamonds'] ?? 0); ?> üíé</li>
            <li><?php echo $stats['streak'] ?? 0; ?> <?php echo ($stats['streakActive'] ?? false) ? 'üî•' : 'üßä'; ?></li>
        <?php endif; ?>
        </ul>
        <ul class="right">
            <li><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>
    <nav class="top mobile-only anchor">
        <ul>
        <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?> <meter min="0" max="1" value="<?php echo ($stats['expPercentage'] ?? 0); ?>"></meter></li>
            <li><?php echo number_format($stats['diamonds'] ?? 0); ?> üíé</li>
            <li><?php echo $stats['streak'] ?? 0; ?> <?php echo ($stats['streakActive'] ?? false) ? 'üî•' : 'üßä'; ?></li>
        <?php endif; ?>
        </ul>
    </nav>
    <main class="scrollable">
        <div class="upload-container">
            <?php if ($cooldown['can_upload'] ?? false): ?>
                <div class="upload-ready">
                    <div class="upload-status">
                        <span class="status-icon">‚úÖ</span>
                        <h2>Ready to Upload!</h2>
                        <?php if ($cooldown['has_reducer'] ?? false): ?>
                            <p class="reducer-badge">‚è∞ Cooldown Reducer Active (8h)</p>
                        <?php endif; ?>
                    </div>
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="dotted-border" id="dropZone">
                            <h3>Upload your meme</h3>
                            <p>Max file size: 10MB</p>
                            <p>Formats: JPEG, PNG, GIF, WebP</p>
                            <input type="file" id="imageInput" name="image" accept="image/jpeg,image/png,image/gif,image/webp" hidden>
                            <button type="button" class="upload-button" id="selectFileBtn">Select File</button>
                            <div id="previewContainer" class="preview-container" style="display: none;">
                                <img id="imagePreview" src="" alt="Preview">
                                <button type="button" id="removePreview" class="remove-preview">‚úï</button>
                            </div>
                        </div>
                        <button type="submit" id="submitBtn" class="submit-button" disabled>Upload Meme</button>
                    </form>
                </div>
            <?php else: ?>
                <div class="upload-cooldown">
                    <div class="cooldown-status">
                        <span class="status-icon">‚è≥</span>
                        <p>Next upload available in:</p>
                        <h1 id="cooldownTimer">
                            <?php 
                                $hours = str_pad($cooldown['hours'] ?? 0, 2, '0', STR_PAD_LEFT);
                                $minutes = str_pad($cooldown['minutes'] ?? 0, 2, '0', STR_PAD_LEFT);
                                $seconds = str_pad($cooldown['seconds'] ?? 0, 2, '0', STR_PAD_LEFT);
                                echo "{$hours}:{$minutes}:{$seconds}";
                            ?>
                        </h1>
                        <?php if (!($cooldown['has_reducer'] ?? false)): ?>
                            <p class="reducer-hint">üí° Tip: Buy the Cooldown Reducer in the store to reduce wait time to 8 hours!</p>
                        <?php else: ?>
                            <p class="reducer-badge">‚è∞ Cooldown Reducer Active (8h cooldown)</p>
                        <?php endif; ?>
                    </div>
                    <div class="dotted-border disabled">
                        <h3>Upload file</h3>
                        <p>Max file size: 10MB</p>
                        <button class="upload-button" disabled>Upload File</button>
                    </div>
                </div>
            <?php endif; ?>
        </div>
        
        <!-- Upload Success Popup -->
        <div id="uploadPopup" class="popup-overlay">
            <div class="popup-content">
                <div class="popup-icon" id="popupIcon">üéâ</div>
                <h2 id="popupTitle">Upload Successful!</h2>
                <p id="popupMessage">Your meme has been uploaded!</p>
                <button id="popupClose" class="popup-btn">OK</button>
            </div>
        </div>

        <!-- Streak Extended Popup -->
        <div id="streakExtendedPopup" class="popup-overlay">
            <div class="popup-content streak-success">
                <div class="popup-icon">üî•</div>
                <h2>STREAK EXTENDED!</h2>
                <p id="streakExtendedMessage">Your streak is now 5 days!</p>
                <p class="streak-bonus">Keep it up!</p>
                <button id="streakExtendedClose" class="popup-btn">Nice!</button>
            </div>
        </div>

        <!-- Streak Lost Popup -->
        <div id="streakLostPopup" class="popup-overlay">
            <div class="popup-content streak-lost">
                <div class="popup-icon">üßä</div>
                <h2>STREAK LOST!</h2>
                <p id="streakLostMessage">You lost your 7 day streak...</p>
                <p class="streak-restart">Starting fresh with day 1!</p>
                <button id="streakLostClose" class="popup-btn">Start Again</button>
            </div>
        </div>

        <!-- New Streak Popup -->
        <div id="newStreakPopup" class="popup-overlay">
            <div class="popup-content streak-new">
                <div class="popup-icon">‚ú®</div>
                <h2>WELCOME!</h2>
                <p id="newStreakMessage">Your streak begins today!</p>
                <p class="streak-tip">Come back tomorrow to keep it going!</p>
                <button id="newStreakClose" class="popup-btn">Let's Go!</button>
            </div>
        </div>
        
        <script src="/public/scripts/upload.js"></script>
        <?php if (!($cooldown['can_upload'] ?? true)): ?>
        <script>
            // Pass cooldown seconds to external script
            window.cooldownSeconds = <?php echo $cooldown['time_remaining'] ?? 0; ?>;
        </script>
        <?php endif; ?>
        <?php if (isset($streakInfo)): ?>
        <script>
            window.streakInfo = <?php echo json_encode($streakInfo); ?>;
        </script>
        <?php endif; ?>
        <script src="/public/scripts/streak.js"></script>
    </main>
        <nav class="bottom mobile-only anchor">
        <ul>
            <li class="mobile-only"><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li class="mobile-only"><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li class="mobile-only"><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li class="mobile-only"><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li class="mobile-only"><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>
</body>
</html>