<!DOCTYPE html>
<html>
<head>
    <title>Profile</title>
    <link rel="stylesheet" type="text/css" href="/public/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/public/styles/profile.css">
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <nav class="top desktop-only anchor">
        <ul class="left">
        <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?> <meter id="disk_d" value="<?php echo ($user['experience'] ?? 0) / 100; ?>"></meter></li>
            <li><?php echo number_format($stats['diamonds'] ?? 0); ?> ðŸ’Ž</li>
            <li><?php echo $stats['streak'] ?? 0; ?> ðŸ”¥</li>
        <?php endif; ?>
        </ul>
        <ul class="right">
            <li><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>
    <nav class="top mobile-only anchor">
        <ul>
            <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?> <meter id="disk_d" value="<?php echo ($user['experience'] ?? 0) / 100; ?>"></meter></li>
            <li><?php echo number_format($stats['diamonds'] ?? 0); ?> ðŸ’Ž</li>
            <li><?php echo $stats['streak'] ?? 0; ?> ðŸ”¥</li>
            <?php endif; ?>
        </ul>
    </nav>
    <main class="scrollable">
        <div>
            <img class="profile-image" src="<?php echo $user['profile_photo'] ?? 'https://picsum.photos/400/400'; ?>">
            <h1><?php echo htmlspecialchars($user['username']) ?? 'User'; ?></h1>
            <p>Level <?php echo $stats['level'] ?? 1 ?></p>
            <p>Streak: <?php echo $stats['streak'] ?? 0 ?> ðŸ”¥</p>
            <p>Diamonds: <?php echo number_format($stats['diamonds'] ?? 0); ?> ðŸ’Ž</p>
            
            <?php if ($isOwnProfile ?? false): ?>
                <div style="display: flex; gap: 1rem; justify-content: center; margin: 1rem 0;">
                    <a href="/profile/edit" style="background-color: var(--VibrantOrange); color: white; padding: 10px 20px; border-radius: 4px; text-decoration: none;">Edit Profile</a>
                    <a href="/logout" style="background-color: var(--LightGray); color: var(--Background); padding: 10px 20px; border-radius: 4px; text-decoration: none;">Logout</a>
                </div>
            <?php endif; ?>
            
            <div class="selection-bar">
                <button class="tab-button active" data-tab="stats">Stats</button>
                <button class="tab-button" data-tab="badges">Badges</button>
                <button class="tab-button" data-tab="collection">Collection</button>
            </div>    
            <div class="tab-content stats active">
                <div class="stats-grid">
                    <p class="stats-item">Longest streak: <?php echo $stats['longest_streak'] ?? 0; ?></p>
                    <p class="stats-item">Posts: <?php echo $stats['posts_count'] ?? 0; ?></p>
                    <p class="stats-item">Experience: <?php echo $stats['experience'] ?? 0; ?> XP</p>
                </div>
            </div>
            <div class="tab-content badges">
                <?php if (!empty($badges)): ?>
                    <div class="badges-grid">
                        <?php foreach ($badges as $badge): ?>
                            <div class="badge-item">
                                <p><?php echo htmlspecialchars($badge['name']); ?></p>
                                <img src="<?php echo htmlspecialchars($badge['icon']); ?>" alt="Badge Icon">
                                <p><?php echo htmlspecialchars($badge['description']); ?></p>
                            </div>
                        <?php endforeach; ?>
                    </div>
                <?php endif; ?>
            </div>
            <div class="tab-content collection">
                <?php if (!empty($posts)): ?>
                    <div class="posts-grid">
                        <?php foreach ($posts as $post): ?>
                            <div class="post-item">
                                <img src="<?php echo htmlspecialchars($post['image']); ?>" alt="Meme Image">
                                <p><?php echo htmlspecialchars("Upvotes : ".$post['upvotes']); ?></p>
                                <p><?php echo htmlspecialchars("Downvotes : ".$post['downvotes']); ?></p>
                            </div>
                        <?php endforeach; ?>
                    </div>
                <?php endif; ?>
            </div>
            
            <script>
                // Tab switching functionality
                document.addEventListener('DOMContentLoaded', function() {
                    const tabButtons = document.querySelectorAll('.tab-button');
                    const tabContents = document.querySelectorAll('.tab-content');
                    
                    tabButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const targetTab = this.getAttribute('data-tab');
                            
                            // Remove active class from all buttons and contents
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            tabContents.forEach(content => content.classList.remove('active'));
                            
                            // Add active class to clicked button and corresponding content
                            this.classList.add('active');
                            document.querySelector('.tab-content.' + targetTab).classList.add('active');
                        });
                    });
                });
            </script>
        </div>
    </main>
    <nav class="bottom mobile-only anchor">
        <ul>
            <li class="mobile-only"><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li class="mobile-only"><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li class="mobile-only"><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li class="mobile-only"><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li class="mobile-only"><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>
</body>
</html>