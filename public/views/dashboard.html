<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/public/styles/main.css">
    <link rel="stylesheet" type="text/css" href="/public/styles/dashboard.css">
</head>
<body>
    
    <nav class="top">
        <ul class="left">
        <?php if (isset($_SESSION['user_id'])): ?>
            <li>Lvl <span id="user-level"><?php echo htmlspecialchars($stats['level'] ?? 'N/A'); ?></span> <meter id="exp-meter" min="0" max="1" value="<?php echo ($stats['expPercentage'] ?? 0); ?>"></meter></li>
            <li><span id="user-diamonds"><?php echo number_format($stats['diamonds'] ?? 0); ?></span> ðŸ’Ž</li>
            <li><span id="user-streak"><?php echo $stats['streak'] ?? 0; ?></span> <?php echo ($stats['streakActive'] ?? false) ? 'ðŸ”¥' : 'ðŸ§Š'; ?></li>
        <?php endif; ?>
        </ul>
        <ul class="right">
            <li class="desktop-only"><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li class="desktop-only"><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li class="desktop-only"><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li class="desktop-only"><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li class="desktop-only"><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>

    <div class="container">
        <?php if ($post): ?>
            <div id="post-container" data-post-id="<?php echo $post['id']; ?>">
                <img id="post-image" src="<?php echo htmlspecialchars($post['image']); ?>" alt="Meme">
                <div class="post-info">
                    <span class="post-author" onclick="window.location.href='/profile/<?php echo htmlspecialchars($post['username']); ?>'">@<?php echo htmlspecialchars($post['username']); ?></span>
                </div>
            </div>
        <?php else: ?>
            <div id="post-container" class="no-posts">
                <p>No more posts to vote on! Check back later or upload your own meme!</p>
                <a href="/upload" class="upload-link">Upload a Meme</a>
            </div>
        <?php endif; ?>
    </div>

    <!-- Reward Popup -->
    <div id="rewardPopup" class="reward-popup">
        <div class="reward-content">
            <span id="reward-exp">+15 XP</span>
            <span id="reward-diamonds">+5 ðŸ’Ž</span>
        </div>
    </div>

    <!-- Level Up Popup -->
    <div id="levelUpPopup" class="popup-overlay">
        <div class="popup-content level-up">
            <div class="popup-icon">ðŸŽ‰</div>
            <h2>LEVEL UP!</h2>
            <p id="levelUpMessage">You reached level 5!</p>
            <p id="levelUpBonus">Bonus: +250 ðŸ’Ž</p>
            <button id="levelUpClose" class="popup-btn">Awesome!</button>
        </div>
    </div>

    <!-- Login Required Popup -->
    <div id="loginPopup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-icon">ðŸ”’</div>
            <h2>Login Required</h2>
            <p>You need to be logged in to vote and earn rewards!</p>
            <div class="popup-buttons">
                <a href="/login" class="popup-btn">Login</a>
                <a href="/register" class="popup-btn secondary">Register</a>
            </div>
        </div>
    </div>

    <!-- Streak Extended Popup -->
    <div id="streakExtendedPopup" class="popup-overlay">
        <div class="popup-content streak-success">
            <div class="popup-icon">ðŸ”¥</div>
            <h2>STREAK EXTENDED!</h2>
            <p id="streakExtendedMessage">Your streak is now 5 days!</p>
            <p class="streak-bonus">Keep it up!</p>
            <button id="streakExtendedClose" class="popup-btn">Nice!</button>
        </div>
    </div>

    <!-- Streak Lost Popup -->
    <div id="streakLostPopup" class="popup-overlay">
        <div class="popup-content streak-lost">
            <div class="popup-icon">ðŸ§Š</div>
            <h2>STREAK LOST!</h2>
            <p id="streakLostMessage">You lost your 7 day streak...</p>
            <p class="streak-restart">Starting fresh with day 1!</p>
            <button id="streakLostClose" class="popup-btn">Start Again</button>
        </div>
    </div>

    <!-- New Streak Popup -->
    <div id="newStreakPopup" class="popup-overlay">
        <div class="popup-content streak-new">
            <div class="popup-icon">âœ¨</div>
            <h2>WELCOME!</h2>
            <p id="newStreakMessage">Your streak begins today!</p>
            <p class="streak-tip">Come back tomorrow to keep it going!</p>
            <button id="newStreakClose" class="popup-btn">Let's Go!</button>
        </div>
    </div>

    <nav class="bottom">
        <ul>
            <?php if (isset($_SESSION['user_id'])): ?>
                <li class="desktop-only"><button type="button" id="downvote-btn" <?php echo !$post ? 'disabled' : ''; ?>>Downvote <span class="material-symbols-outlined">thumb_down</span></button></li>
                <li class="desktop-only"><button type="button" id="upvote-btn" <?php echo !$post ? 'disabled' : ''; ?>>Upvote <span class="material-symbols-outlined">thumb_up</span></button></li>
            <?php else: ?>
                <li class="desktop-only"><button type="button" id="login-prompt-btn">Login to Vote <span class="material-symbols-outlined">login</span></button></li>
            <?php endif; ?>
        </ul>
    </nav>
    <nav class="bottom mobile-only anchor">
        <ul>
            <li class="mobile-only"><a href="/dashboard">Swipe<span class="material-symbols-outlined">home</span></a></li>
            <li class="mobile-only"><a href="/quests">Quests<span class="material-symbols-outlined">trophy</span></a></li>
            <li class="mobile-only"><a href="/leaders">Leaders<span class="material-symbols-outlined">leaderboard</span></a></li>
            <li class="mobile-only"><a href="/upload">Upload<span class="material-symbols-outlined">upload</span></a></li>
            <li class="mobile-only"><a href="/profile">Profile<span class="material-symbols-outlined">person</span></a></li>
        </ul>
    </nav>

    <?php if (isset($_SESSION['user_id'])): ?>
    <script src="/public/scripts/dashboard.js"></script>
    <?php endif; ?>
    
    <!-- Global streak popup handling -->
    <?php if (isset($streakInfo)): ?>
    <script>
        window.streakInfo = <?php echo json_encode($streakInfo); ?>;
    </script>
    <?php endif; ?>
    <script src="/public/scripts/streak.js"></script>
    
    <?php if (!isset($_SESSION['user_id'])): ?>
    <script src="/public/scripts/dashboard-login.js"></script>
    <?php endif; ?>
</body>
</html>